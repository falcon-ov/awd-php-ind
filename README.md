# Индивидуальная работа по PHP

## JobVocab - Веб-приложение для изучения профессиональных терминов

## Описание лабораторной работы

Авторы: Годорожа Оксана, Соколов Даниил
Группа: I2302

**JobVocab** — это веб-приложение, разработанное в рамках индивидуальной работы по курсу веб-программирования. Приложение представляет собой словарь профессиональных терминов с функцией создания и прохождения квизов для проверки знаний. Оно включает функционал аутентификации, управления терминами, квизами и предложениями терминов, а также публичный раздел для поиска и просмотра терминов. Приложение построено на модульной архитектуре MVC с использованием PHP и SQLite, с акцентом на безопасность, удобство использования и современный дизайн.

Цель работы: разработать веб-приложение средней сложности с серверной логикой, отвечающее требованиям задания, включая аутентификацию, защищённые и общедоступные компоненты, формы взаимодействия, управление данными и визуально привлекательный интерфейс.

---

## Инструкции по запуску проекта

### Требования
- PHP 7.4 или выше
- SQLite3
- Веб-сервер


### Установка
1. **Клонируйте репозиторий**:
   ```bash
   git clone https://github.com/falcon-ov/awd-php-ind
   cd awd-php-ind
   ```

2. **Инициализация базы данных**:
   Выполните скрипт для создания структуры базы данных и добавления тестовых данных:
   ```bash
   php init_db.php
   ```
   Это создаст файл `data/jobvocab.db` с таблицами и тестовыми данными (админ: логин `admin`, пароль `admin123`).

3. **Настройка веб-сервера**:
   - Убедитесь, что корневая папка сервера указывает на директорию `public/`.
   - Если используете встроенный сервер PHP:
     ```bash
     php -S localhost:8088 -t public/
     ```

4. **Настройка фонового изображения** (опционально):
   - Поместите изображение (например, `background.jpg`) в папку `public/css/` для использования в качестве фона.

5. **Доступ к приложению**:
   Откройте браузер и перейдите по адресу `http://localhost:8088`.

---

## Документация проекта

### Содержание
1. Функциональные возможности
2. Сценарии взаимодействия пользователей
3. Структура базы данных
4. Стилизация
5. Примеры использования
6. Ответы на контрольные вопросы
7. Список использованных источников

### 1. Функциональные возможности

#### Аутентификация
- **Регистрация**: Пользователи создают учётную запись, указав логин, email и пароль. Пароли хешируются с использованием алгоритма BCRYPT. Валидация проверяет уникальность логина и email.
- **Вход**: Авторизация по логину и паролю с проверкой хеша через `password_verify`. После входа пользователь получает доступ к защищённым разделам.
- **Выход**: Завершение сессии с очисткой данных `$_SESSION`.
- **Безопасность**: Защита от XSS (через `htmlspecialchars`), SQL-инъекций (через PDO) и обхода аутентификации (проверка `$_SESSION['role']`).

#### Общедоступный компонент
- **Главная страница** (`/`): Отображает список всех активных терминов в виде карточек с названием и кратким описанием.
- **Поиск терминов** (`/search`): Форма поиска с динамической фильтрацией терминов по ключевым словам, реализованная через SQL-запрос с `LIKE`.
- **Квизы** (`/quiz`): Публичные квизы доступны для прохождения всем пользователям, с отображением результатов (правильные/неправильные ответы).

#### Формы взаимодействия
- **Форма создания квиза** (`/quiz/create`):
  - Поля: название квиза, выбор терминов (чекбоксы с названиями и обрезанными до 100 символов определениями).
  - Валидация: обязательное название и выбор минимум одного термина (на клиенте через HTML5 `required`, на сервере через PHP).
  - Ошибки отображаются в стилизованных карточках.
- **Форма поиска терминов** (`/search`):
  - Поле: текстовое поле для ключевого слова.
  - Результаты фильтруются в реальном времени и отображаются в карточках.
- **Форма предложения термина** (`/term/suggest`):
  - Поля: название и определение термина.
  - Доступна только авторизованным пользователям, данные сохраняются в таблице `term_suggestions`.

#### Защищённый компонент
- Доступен только авторизованным пользователям через проверку `$_SESSION['user_id']`.
- **Роль администратора**:
  - **Управление терминами** (`/admin/terms`): Создание, редактирование, удаление терминов с валидацией полей (`title`, `definition`, `status`). Статус может быть `active` или `inactive`.
  - **Управление пользователями** (`/admin/users`): Создание учётных записей (с указанием логина, email, пароля и роли `user`/`admin`), удаление пользователей (кроме самого себя).
  - **Управление квизами** (`/admin/quizzes`): Создание квизов с выбором терминов, удаление квизов с очисткой связанных данных (`quiz_terms`, `quiz_results`).
  - **Управление предложениями терминов** (`/admin/suggestions`): Просмотр предложений, их одобрение (с выбором статуса `active`/`inactive`) или отклонение.
- **Роль пользователя**:
  - Предложение терминов на модерацию через `/term/suggest`.
  - Создание личных квизов через `/quiz/create` с выбором терминов и их определений.

#### Дополнительные функции
- **Предложение терминов**: Пользователи отправляют термины на модерацию, которые сохраняются в таблице `term_suggestions` и проверяются администратором.
- **Квизы**: Пользователи создают квизы, выбирая термины, и проходят их, получая результаты, которые сохраняются в таблице `quiz_results`.
- **Статистика**: Админ-панель (`/admin/dashboard`) отображает количество терминов, пользователей и квизов в виде стилизованных карточек.

### 2. Сценарии взаимодействия пользователей

#### Гость
1. Переходит на главную страницу, видит список терминов в карточках.
2. Использует форму поиска для фильтрации терминов по ключевым словам.
3. Выбирает публичный квиз, проходит его и видит результат.
4. Переходит на страницу регистрации или входа для доступа к дополнительным функциям.

#### Пользователь
1. Регистрируется или входит в систему.
2. Предлагает новый термин через форму `/term/suggest`, указав название и определение.
3. Создаёт квиз на `/quiz/create`, выбирая термины (с отображением их определений), и проходит его.
4. Проходит доступные квизы и видит результаты в виде количества правильных ответов.

#### Администратор
1. Входит в систему с ролью `admin`.
2. Переходит в админ-панель (`/admin/dashboard`), видит статистику.
3. Управляет терминами: создаёт, редактирует, удаляет на `/admin/terms`.
4. Управляет пользователями: создаёт новые учётные записи, удаляет существующие на `/admin/users`.
5. Управляет квизами: создаёт, удаляет на `/admin/quizzes`.
6. Просматривает и модерирует предложения терминов на `/admin/suggestions`.

### 3. Структура базы данных

База данных SQLite (`data/jobvocab.db`) состоит из следующих таблиц, каждая из которых выполняет определённую роль в приложении:

#### Таблица `users`
| Поле        | Тип       | Описание                              |
|-------------|-----------|---------------------------------------|
| id          | INTEGER   | Уникальный идентификатор (PK)         |
| username    | TEXT      | Имя пользователя (уникальное)         |
| password    | TEXT      | Хешированный пароль                   |
| email       | TEXT      | Email (уникальный)                    |
| role        | TEXT      | Роль (`user` или `admin`)             |
| created_at  | DATETIME  | Дата создания                         |

**Назначение**: Хранит информацию о зарегистрированных пользователях, включая их учётные данные и роли. Используется для аутентификации (`username`, `password`), авторизации (`role`) и отслеживания создателей терминов, квизов и результатов (`id`). Поле `created_at` помогает отслеживать дату регистрации.

#### Таблица `terms`
| Поле        | Тип       | Описание                              |
|-------------|-----------|---------------------------------------|
| id          | INTEGER   | Уникальный идентификатор (PK)         |
| title       | TEXT      | Название термина                      |
| definition  | TEXT      | Определение термина                   |
| status      | TEXT      | Статус (`active` или `inactive`)      |
| created_by  | INTEGER   | ID создателя (FK: users.id)           |
| created_at  | DATETIME  | Дата создания                         |

**Назначение**: Хранит профессиональные термины, которые составляют основной контент приложения. Поля `title` и `definition` используются для отображения на главной странице, в поиске и в квизах. Поле `status` определяет, виден ли термин публично (`active`) или скрыт (`inactive`). Поле `created_by` связывает термин с пользователем, создавшим его, а `created_at` фиксирует дату добавления.

#### Таблица `term_suggestions`
| Поле        | Тип       | Описание                              |
|-------------|-----------|---------------------------------------|
| id          | INTEGER   | Уникальный идентификатор (PK)         |
| title       | TEXT      | Название предложенного термина        |
| definition  | TEXT      | Определение термина                   |
| status      | TEXT      | Статус (`pending`)                    |
| created_by  | INTEGER   | ID автора (FK: users.id)              |
| created_at  | DATETIME  | Дата создания                         |

**Назначение**: Хранит термины, предложенные пользователями для модерации. Поля `title` и `definition` содержат данные, которые администратор может одобрить (перенеся в таблицу `terms`) или отклонить. Поле `status` фиксирует состояние (`pending`), `created_by` указывает автора предложения, а `created_at` — дату подачи.

#### Таблица `quizzes`
| Поле        | Тип       | Описание                              |
|-------------|-----------|---------------------------------------|
| id          | INTEGER   | Уникальный идентификатор (PK)         |
| title       | TEXT      | Название квиза                        |
| user_id     | INTEGER   | ID создателя (FK: users.id)           |
| is_public   | INTEGER   | Флаг общедоступности (0 или 1)        |
| created_at  | DATETIME  | Дата создания                         |

**Назначение**: Хранит информацию о квизах, созданных пользователями или администраторами. Поле `title` отображается в списках квизов, `user_id` связывает квиз с его создателем, `is_public` определяет, доступен ли квиз всем пользователям (1) или только создателю (0). Поле `created_at` фиксирует дату создания.

#### Таблица `quiz_terms`
| Поле        | Тип       | Описание                              |
|-------------|-----------|---------------------------------------|
| quiz_id     | INTEGER   | ID квиза (PK, FK: quizzes.id)         |
| term_id     | INTEGER   | ID термина (PK, FK: terms.id)         |

**Назначение**: Связывает квизы с терминами, которые в них используются. Эта таблица реализует отношение "многие ко многим" между `quizzes` и `terms`, позволяя каждому квизу включать несколько терминов, а каждому термину быть частью нескольких квизов. Используется при создании квиза и генерации вопросов.

#### Таблица `quiz_results`
| Поле            | Тип       | Описание                              |
|-----------------|-----------|---------------------------------------|
| id              | INTEGER   | Уникальный идентификатор (PK)         |
| user_id         | INTEGER   | ID пользователя (FK: users.id)        |
| quiz_id         | INTEGER   | ID квиза (FK: quizzes.id)             |
| score           | INTEGER   | Количество правильных ответов         |
| total_questions | INTEGER   | Общее количество вопросов             |
| created_at      | DATETIME  | Дата прохождения                      |

**Назначение**: Хранит результаты прохождения квизов пользователями. Поле `user_id` указывает, кто проходил квиз, `quiz_id` — какой квиз, `score` и `total_questions` позволяют вычислить процент правильных ответов. Поле `created_at` фиксирует дату прохождения, что полезно для анализа активности.

### 4. Стилизация
- **Основной цвет**: Розовый (`#e91e63`) с оттенками (`#c2185b` для ховера, `#f8bbd0` для фонов).
- **Фоновое изображение**: Поддерживается пользовательское изображение (например, `public/css/background.jpg`), растянутое на весь экран с фиксированным позиционированием.
- **Современные эффекты**:
  - Градиенты для хедера и футера.
  - Тени и скругления для форм, таблиц, карточек и элементов терминов.
  - Анимации при наведении (поднятие кнопок, масштабирование ссылок).
  - Плавное появление контента с помощью CSS-анимации (`fadeIn`).
- **Шрифты**: Используется шрифт Arial по умолчанию, с возможностью подключения Google Fonts (например, Roboto) для улучшенной типографики.
- **Чекбоксы и радио-кнопки**: Кастомизированы с розовым акцентом и увеличенным размером.
- **Адаптивность**: Стили оптимизированы для десктопов, с возможностью добавления медиа-запросов для мобильных устройств.

### 5. Примеры использования

#### Скриншоты

![img](/README-images/image_1.png)
![img](/README-images/image_2.png)
![img](/README-images/image_3.png)
![img](/README-images/image_4.png)
![img](/README-images/image_5.png)
![img](/README-images/image_6.png)
![img](/README-images/image_7.png)

### Описание
1. **Главная страница** (`/`):
   - Отображает список терминов в виде карточек с розовой темой, полупрозрачным фоном для читаемости и фоновым изображением.
   - Доступна всем пользователям.

2. **Форма поиска** (`/search`):
   - Пользователь вводит ключевое слово, результаты фильтруются динамически в стилизованных карточках с анимацией появления.

3. **Создание квиза** (`/quiz/create`):
   - Пользователь выбирает термины с чекбоксами, рядом с каждым термином отображается его определение (обрезается до 100 символов).
   - Форма имеет розовые акценты, тени, анимации и стилизованные элементы `.term-item`.

4. **Админ-панель** (`/admin/dashboard`):
   - Отображает статистику (количество терминов, пользователей, квизов) в виде стилизованных карточек.
   - Ссылки на управление данными с анимацией при наведении.

#### Фрагмент кода (валидация ввода)
```php
function validateInput($input) {
    return htmlspecialchars(trim($input), ENT_QUOTES, 'UTF-8');
}
```
Этот код защищает от XSS-атак, обрабатывая пользовательский ввод для всех форм.

#### Фрагмент кода (стилизация формы создания квиза)
```php
<div class="term-item">
    <label>
        <input type="checkbox" name="term_ids[]" value="<?php echo $term['id']; ?>">
        <strong><?php echo htmlspecialchars($term['title']); ?></strong>
    </label>
    <p class="term-definition"><?php echo htmlspecialchars(substr($term['definition'], 0, 100)) . (strlen($term['definition']) > 100 ? '...' : ''); ?></p>
</div>
```
Этот код отображает термины с определениями в форме создания квиза, с применением стилей `.term-item` (тени, скругления, эффект поднятия при наведении) и `.term-definition` (серый текст, отступ).

#### Фрагмент кода (управление терминами в админ-панели)
```php
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['update'])) {
    $term_id = (int)$_POST['id'];
    $title = validateInput($_POST['title']);
    $definition = validateInput($_POST['definition']);
    $status = validateInput($_POST['status']);
    if (!in_array($status, ['active', 'inactive'])) {
        $_SESSION['message'] = 'Ошибка: Неверный статус термина.';
    } else {
        Term::update($term_id, $title, $definition, $status);
        $_SESSION['message'] = 'Термин обновлён успешно.';
    }
    header('Location: /admin/terms');
    exit;
}
```
Этот код из `AdminController.php` обрабатывает обновление термина, включая валидацию и сохранение в базу данных.

### 6. Ответы на контрольные вопросы
1. **Как обеспечивается безопасность паролей?**
   Пароли хешируются с использованием алгоритма BCRYPT (`password_hash`) и хранятся в базе данных в защищённом виде. Проверка выполняется через `password_verify`.

2. **Как реализована валидация данных?**
   Все пользовательские данные проходят валидацию на клиенте (HTML5 `required`) и сервере (функция `validateInput` для защиты от XSS, проверки уникальности `username` и `email`, валидация статуса терминов). Ошибки отображаются в стилизованных карточках с розовыми акцентами.

3. **Как организована модульная архитектура?**
   Приложение использует MVC:
   - **Model**: Классы `User`, `Term`, `Quiz` для работы с базой данных через PDO.
   - **View**: PHP-шаблоны в папке `views/` с розовой темой, анимациями и поддержкой фонового изображения.
   - **Controller**: Классы `AuthController`, `PublicController`, `TermController`, `QuizController`, `AdminController` для обработки запросов и маршрутизации.

4. **Как работает управление сессиями?**
   Сессии (`session_start`) используются для хранения `user_id` и `role`. Доступ к защищённым разделам проверяется через `$_SESSION`, с редиректом на `/login` при отсутствии авторизации.

### 7. Список использованных источников
- PHP Documentation: https://www.php.net/docs.php
- PDO SQLite: https://www.php.net/manual/en/book.sqlite3.php
- HTML5 Forms: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form
- CSS Styling: https://developer.mozilla.org/en-US/docs/Web/CSS
- BCRYPT Password Hashing: https://www.php.net/manual/en/function.password-hash.php
- Google Fonts (Roboto): https://fonts.google.com/specimen/Roboto
- CSS Animations: https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Animations

---

## Другие важные аспекты
- **Архитектура**: Приложение построено по принципам MVC, что упрощает поддержку и расширение. Контроллеры обрабатывают маршруты, модели взаимодействуют с базой, а представления обеспечивают современный интерфейс.
- **Безопасность**: Реализована защита от XSS (через `htmlspecialchars`), SQL-инъекций (через PDO с подготовленными запросами) и обхода аутентификации (проверка `$_SESSION`). Все формы валидируются на клиенте и сервере.
- **Стилизация**: Приложение использует розовую тему (`#e91e63`) с поддержкой фонового изображения (`public/css/background.jpg`), градиентами, тенями и анимациями для современного вида.
- **Ограничения**:
  - Функция восстановления пароля не реализована из-за ограничений времени. Возможное улучшение — интеграция с email-сервисами.
  - Удалена вкладка "Мои термины" для упрощения интерфейса и фокуса на создании квизов.
- **Тестирование**: Тестовые данные добавляются через `init_db.php` для упрощения проверки. Рекомендуется использовать логин `admin` (пароль `admin123`) для проверки админ-панели.

---

Ссылка на репозиторий: [https://github.com/your-username/jobvocab](https://github.com/your-username/jobvocab)